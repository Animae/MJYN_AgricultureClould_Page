webpackJsonp([9],{"./app/containers/FarmPage/sagas.js":function(t,e,n){"use strict";function r(t){var e,r,a;return regeneratorRuntime.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,e=P.serverHost+"/api/farm?farmId="+t.payload,i.next=4,n.i(o.call)(g.a,e,{method:"GET",credentials:"include"});case 4:if(r=i.sent,!r.data){i.next=20;break}return i.next=8,n.i(o.put)(n.i(p.f)(n.i(x.a)(r.data)));case 8:return console.log(n.i(x.a)(r.data)),i.next=11,n.i(o.put)(n.i(p.g)(r.data.id));case 11:return a=n.i(v.a)(r.data),i.next=14,n.i(o.put)(n.i(d.a)(a));case 14:return i.next=16,n.i(o.put)(n.i(l.h)());case 16:return i.next=18,n.i(o.call)(m.toast.info,"农场信息加载成功");case 18:i.next=22;break;case 20:return i.next=22,n.i(o.call)(m.toast.error,"农场数据加载失败, "+r.message);case 22:i.next=28;break;case 24:return i.prev=24,i.t0=i.catch(0),i.next=28,n.i(o.call)(m.toast.error,"农场数据加载失败, 请稍后刷新页面重试");case 28:case"end":return i.stop()}},j[0],this,[[0,24]])}function a(){var t,e,r,a,i,u;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.next=2,n.i(o.select)(n.i(f.e)());case 2:return t=c.sent,c.next=5,n.i(o.select)(n.i(f.f)());case 5:return e=c.sent,c.next=8,n.i(o.select)(n.i(f.d)());case 8:return r=c.sent,a=P.serverHost+"/api/farm/"+(null==t?"create":"update"),i=null==t?"创建":"更新",c.prev=11,c.next=14,n.i(o.call)(g.a,a,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:t,name:e,pointList:r.map(function(t){return{latitude:t.lat,longitude:t.lng}})})});case 14:if(u=c.sent,!u.data){c.next=25;break}return c.next=18,n.i(o.call)(m.toast.info,"农场"+i+"成功");case 18:if(!t){c.next=21;break}return c.next=21,n.i(o.put)(n.i(p.a)(t));case 21:return c.next=23,n.i(o.put)(n.i(s.push)("/farm/view/"+(null==t?u.data:t)));case 23:c.next=27;break;case 25:return c.next=27,n.i(o.call)(m.toast.error,"农场"+i+"失败, "+u.message);case 27:c.next=33;break;case 29:return c.prev=29,c.t0=c.catch(11),c.next=33,n.i(o.call)(m.toast.error,"农场"+i+"失败, 请稍后刷新页面重试");case 33:case"end":return c.stop()}},j[1],this,[[11,29]])}function i(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.i(o.takeEvery)(c.e,r);case 2:case"end":return t.stop()}},j[2],this)}function u(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.i(o.takeLatest)(c.f,a);case 2:case"end":return t.stop()}},j[3],this)}Object.defineProperty(e,"__esModule",{value:!0});var o=n("./node_modules/redux-saga/effects.js"),s=(n.n(o),n("./node_modules/react-router-redux/lib/index.js")),c=(n.n(s),n("./app/containers/FarmPage/constants.js")),p=n("./app/containers/FarmPage/actions.js"),d=n("./app/containers/Menu/actions.js"),f=n("./app/containers/FarmPage/selectors.js"),l=n("./app/containers/PlotPage/actions.js"),g=n("./app/utils/request.js"),m=n("./node_modules/react-toastify/lib/index.js"),P=(n.n(m),n("./config/index.js")),x=(n.n(P),n("./app/containers/FarmPage/util/api-transform.js")),v=n("./app/containers/Menu/helper/buildUserMenu.js");e.loadFarmFunc=r,e.sendFarmUpdateRequestFunc=a,e.loadFarmSaga=i,e.sendFarmUpdateRequestSaga=u;var j=[r,a,i,u].map(regeneratorRuntime.mark);e.default=[i,u]},"./app/containers/FarmPage/selectors.js":function(t,e,n){"use strict";var r=n("./node_modules/reselect/es/index.js");n.d(e,"b",function(){return i}),n.d(e,"a",function(){return u}),n.d(e,"c",function(){return o}),n.d(e,"e",function(){return s}),n.d(e,"f",function(){return c}),n.d(e,"d",function(){return p});var a=function(){return function(t){return t.get("farmPage")}},i=function(){return n.i(r.a)(a(),function(t){return t.get("activeFarmId").toString()})},u=function(){return n.i(r.a)(a(),function(t){var e=t.get("activeFarmId"),n=t.get("farms").get(e)||t.get("farms").get("NA");return n.toJS()})},o=function(){return n.i(r.a)(a(),function(t){var e=t.get("editingFarmId");return Object.values(t.get("farms").toJS()).filter(function(t){return null===e||t.id.toString()!==e})})},s=function(){return n.i(r.a)(a(),function(t){return t.get("editingFarmId")})},c=function(){return n.i(r.a)(a(),function(t){return t.get("editingFarmName")})},p=function(){return n.i(r.a)(a(),function(t){return t.get("editingFarmBoundary").toJS()})}},"./app/containers/FarmPage/util/api-transform.js":function(t,e,n){"use strict";var r=n("./app/containers/PlotPage/util/api-transform.js");n.d(e,"a",function(){return a});var a=function(t){return{id:t.id,name:t.name,center:{lat:t.pointList.map(function(t){return t.latitude}).reduce(function(t,e){return t+e},0)/t.pointList.length,lng:t.pointList.map(function(t){return t.longitude}).reduce(function(t,e){return t+e},0)/t.pointList.length},plots:t.areaList.map(r.a).reduce(function(t,e){return t[e.id]=e,t},{}),boundary:{path:t.pointList.map(function(t){return{lat:t.latitude,lng:t.longitude}})}}}},"./app/containers/PlotPage/actions.js":function(t,e,n){"use strict";function r(t){return{type:AREA_EDIT_MODE,payload:t}}function a(t){return{type:d.a,payload:t}}function i(){return{type:d.b}}function u(t){return{type:d.c,payload:t}}function o(t){return{type:d.d,payload:t}}function s(t){return{type:d.e,payload:t}}function c(t){return{type:d.f,payload:t}}function p(){return{type:d.g}}var d=n("./app/containers/PlotPage/constants.js");e.a=r,e.g=a,e.h=i,e.b=u,e.c=o,e.d=s,e.e=c,e.f=p},"./app/containers/PlotPage/constants.js":function(t,e,n){"use strict";n.d(e,"c",function(){return r}),n.d(e,"d",function(){return a}),n.d(e,"e",function(){return i}),n.d(e,"f",function(){return u}),n.d(e,"a",function(){return o}),n.d(e,"b",function(){return s}),n.d(e,"g",function(){return c});var r="app/PlotPage/SELECTED_PLOT_ID_CHANGE",a="app/PlotPage/EDITING_PLOT_ID_CHANGE",i="app/PlotPage/EDITING_PLOT_NAME_CHANGE",u="app/PlotPage/EDITING_PLOT_BOUNDARY_CHANGE",o="app/PlotPage/UPDATE_PLOTS",s="app/PlotPage/LOAD_PLOT",c="app/PlotPage/SEND_PLOT_UPDATE_REQUEST"},"./app/containers/PlotPage/util/api-transform.js":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(t){return{id:t.id,name:t.name,boundary:{path:t.pointList.map(function(t){return{lat:t.latitude,lng:t.longitude}})}}}}});