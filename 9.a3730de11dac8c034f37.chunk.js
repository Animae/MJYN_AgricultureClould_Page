webpackJsonp([9],{"./app/containers/FarmPage/sagas.js":function(t,e,n){"use strict";function r(t){var e,r;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,e=m.serverHost+"/api/farm?farmId="+t.payload,a.next=4,n.i(o.call)(l.a,e,{method:"GET",credentials:"include"});case 4:if(r=a.sent,!r.data){a.next=16;break}return a.next=8,n.i(o.put)(n.i(p.f)(n.i(P.a)(r.data)));case 8:return a.next=10,n.i(o.put)(n.i(p.g)(r.data.id));case 10:return a.next=12,n.i(o.put)(n.i(f.h)());case 12:return a.next=14,n.i(o.call)(g.toast.info,"农场信息加载成功");case 14:a.next=18;break;case 16:return a.next=18,n.i(o.call)(g.toast.error,"农场数据加载失败, "+r.message);case 18:a.next=26;break;case 20:return a.prev=20,a.t0=a.catch(0),a.next=24,n.i(o.call)(g.toast.error,"农场数据加载失败, 请稍后刷新页面重试");case 24:return a.next=26,n.i(o.call)(g.toast.error,JSON.stringify(a.t0));case 26:case"end":return a.stop()}},x[0],this,[[0,20]])}function a(){var t,e,r,a,i,u;return regeneratorRuntime.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,n.i(o.select)(n.i(d.e)());case 2:return t=s.sent,s.next=5,n.i(o.select)(n.i(d.f)());case 5:return e=s.sent,s.next=8,n.i(o.select)(n.i(d.d)());case 8:return r=s.sent,a=m.serverHost+"/api/farm/"+(null==t?"create":"update"),i=null==t?"创建":"更新",s.prev=11,s.next=14,n.i(o.call)(l.a,a,{method:"POST",credentials:"include",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({id:t,name:e,pointList:r.map(function(t){return{latitude:t.lat,longitude:t.lng}})})});case 14:if(u=s.sent,!u.data){s.next=25;break}return s.next=18,n.i(o.call)(g.toast.info,"农场"+i+"成功");case 18:if(!t){s.next=21;break}return s.next=21,n.i(o.put)(n.i(p.a)(t));case 21:return s.next=23,n.i(o.put)(n.i(c.push)("/farm/view/"+(null==t?u.data:t)));case 23:s.next=27;break;case 25:return s.next=27,n.i(o.call)(g.toast.error,"农场"+i+"失败, "+u.message);case 27:s.next=33;break;case 29:return s.prev=29,s.t0=s.catch(11),s.next=33,n.i(o.call)(g.toast.error,"农场"+i+"失败, 请稍后刷新页面重试");case 33:case"end":return s.stop()}},x[1],this,[[11,29]])}function i(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.i(o.takeEvery)(s.e,r);case 2:case"end":return t.stop()}},x[2],this)}function u(){return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.i(o.takeLatest)(s.f,a);case 2:case"end":return t.stop()}},x[3],this)}Object.defineProperty(e,"__esModule",{value:!0});var o=n("./node_modules/redux-saga/effects.js"),c=(n.n(o),n("./node_modules/react-router-redux/lib/index.js")),s=(n.n(c),n("./app/containers/FarmPage/constants.js")),p=n("./app/containers/FarmPage/actions.js"),d=n("./app/containers/FarmPage/selectors.js"),f=n("./app/containers/PlotPage/actions.js"),l=n("./app/utils/request.js"),g=n("./node_modules/react-toastify/lib/index.js"),m=(n.n(g),n("./config/index.js")),P=(n.n(m),n("./app/containers/FarmPage/util/api-transform.js"));e.loadFarmFunc=r,e.sendFarmUpdateRequestFunc=a,e.loadFarmSaga=i,e.sendFarmUpdateRequestSaga=u;var x=[r,a,i,u].map(regeneratorRuntime.mark);e.default=[i,u]},"./app/containers/FarmPage/selectors.js":function(t,e,n){"use strict";var r=n("./node_modules/reselect/es/index.js");n.d(e,"b",function(){return i}),n.d(e,"a",function(){return u}),n.d(e,"c",function(){return o}),n.d(e,"e",function(){return c}),n.d(e,"f",function(){return s}),n.d(e,"d",function(){return p});var a=function(){return function(t){return t.get("farmPage")}},i=function(){return n.i(r.a)(a(),function(t){return t.get("activeFarmId").toString()})},u=function(){return n.i(r.a)(a(),function(t){var e=t.get("activeFarmId"),n=t.get("farms").get(e)||t.get("farms").get("NA");return n.toJS()})},o=function(){return n.i(r.a)(a(),function(t){var e=t.get("editingFarmId");return Object.values(t.get("farms").toJS()).filter(function(t){return null===e||t.id.toString()!==e})})},c=function(){return n.i(r.a)(a(),function(t){return t.get("editingFarmId")})},s=function(){return n.i(r.a)(a(),function(t){return t.get("editingFarmName")})},p=function(){return n.i(r.a)(a(),function(t){return t.get("editingFarmBoundary").toJS()})}},"./app/containers/FarmPage/util/api-transform.js":function(t,e,n){"use strict";var r=n("./app/containers/PlotPage/util/api-transform.js");n.d(e,"a",function(){return a});var a=function(t){return{id:t.id,name:t.name,center:{lat:t.pointList.map(function(t){return t.latitude}).reduce(function(t,e){return t+e},0)/t.pointList.length,lng:t.pointList.map(function(t){return t.longitude}).reduce(function(t,e){return t+e},0)/t.pointList.length},plots:t.areaList.map(r.a).reduce(function(t,e){return t[e.id]=e,t},{}),boundary:{path:t.pointList.map(function(t){return{lat:t.latitude,lng:t.longitude}})}}}},"./app/containers/PlotPage/actions.js":function(t,e,n){"use strict";function r(t){return{type:AREA_EDIT_MODE,payload:t}}function a(t){return{type:d.a,payload:t}}function i(){return{type:d.b}}function u(t){return{type:d.c,payload:t}}function o(t){return{type:d.d,payload:t}}function c(t){return{type:d.e,payload:t}}function s(t){return{type:d.f,payload:t}}function p(){return{type:d.g}}var d=n("./app/containers/PlotPage/constants.js");e.a=r,e.g=a,e.h=i,e.b=u,e.c=o,e.d=c,e.e=s,e.f=p},"./app/containers/PlotPage/constants.js":function(t,e,n){"use strict";n.d(e,"c",function(){return r}),n.d(e,"d",function(){return a}),n.d(e,"e",function(){return i}),n.d(e,"f",function(){return u}),n.d(e,"a",function(){return o}),n.d(e,"b",function(){return c}),n.d(e,"g",function(){return s});var r="app/PlotPage/SELECTED_PLOT_ID_CHANGE",a="app/PlotPage/EDITING_PLOT_ID_CHANGE",i="app/PlotPage/EDITING_PLOT_NAME_CHANGE",u="app/PlotPage/EDITING_PLOT_BOUNDARY_CHANGE",o="app/PlotPage/UPDATE_PLOTS",c="app/PlotPage/LOAD_PLOT",s="app/PlotPage/SEND_PLOT_UPDATE_REQUEST"},"./app/containers/PlotPage/util/api-transform.js":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var r=function(t){return{id:t.id,name:t.name,boundary:{path:t.pointList.map(function(t){return{lat:t.latitude,lng:t.longitude}})}}}}});